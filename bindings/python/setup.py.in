#!/usr/bin/env python

# Copyright 2002 Gary Bishop and Alan W. Irwin
# This file is part of PLplot.

# PLplot is free software; you can redistribute it and/or modify
# it under the terms of the GNU Library General Public License as published by
# the Free Software Foundation; version 2 of the License.

# PLplot is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Library General Public License for more details.

# You should have received a copy of the GNU Library General Public License
# along with the file PLplot; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307  USA

from distutils.core import setup, Extension

# Hacked special plplot logic at start of setup.py to sort out different
# behaviour for install location (special *last* option of relocatable PREFIX).
import sys
# When drop python-1.5 support this can be dropped since only needed for 
# split which is built-in method for string objects for python2.
import string

include_directory = "../../include/"
library_directory = "../../src/.libs/"
# Following commented out because it is not cross-platform.  
# Perhaps python sorts the rpath stuff out itself in a cross-platform way?
# extra_link_args = string.split("@INSTALL_RPATH@")
extra_link_args = ""

include_dirs = [include_directory]
include_dirs.append("../../libltdl/")
# Only needed because arrayobject.h not necessarily in Numeric subdirectory 
# in python-1.5.  Once we drop support for python-1.5, then we can change 
# the include to standard Numeric/ form and drop this append 
# altogether.
include_dirs.append("@PYTHON_NUM_DIR@")

library_dirs = [library_directory]
libraries = ["plplot@LIB_TAG@"]

# Done with special PLplot logic to decide extra_link_args, include_dirs,
# library_dirs and libraries.

# Only need this to support legacy python 1.5.  Once we drop that support
# and go to pure python 2 use libs.split method here and below for incs_list.
import string
# Old idea here for libs was a long shopping list of options,
# but instead disable with empty string (although keep the logic just
# in case).
libs = ""
libs_list = string.split(libs," ")
#python 2.x libs_list = libs.split(" ")
for option in libs_list:
    if option == "":
	# Do nothing if any extra blank space makes for empty string
	continue
    elif option[0:2] == "-L":
	library_dirs.append(option[2:len(option)])
    elif option[0:2] =="-l":
	libraries.append(option[2:len(option)])
    else:
	raise "bad LIBS"

# Also disable long shopping list of include options (although keep logic).
incs = ""
incs_list = string.split(incs," ")
#python 2.x incs_list = incs.split(" ")
for option in incs_list:
    if option == "":
	# Do nothing if any extra blank space makes for empty string
	continue
    elif option[0:2] == "-I":
	include_dirs.append(option[2:len(option)])
    else:
	raise "bad INCS"

#Now get on with usual setup.py stuff.
module1 = Extension( "plplotcmodule", 
		     extra_link_args = extra_link_args,
                     include_dirs = include_dirs,
		     library_dirs = library_dirs,
		     libraries = libraries,
		     sources = ["plplotcmodule.c"]
		     )

module2 = Extension( "plplot_widgetmodule", 
		     extra_link_args = extra_link_args,
                     include_dirs = include_dirs,
		     library_dirs = library_dirs,
		     libraries = libraries,
		     sources = ["plplot_widgetmodule.c"]
		     )

setup( name = "plplot",
       version = "5.1",
       description = "PLplot Python extension modules",
       author = "Alan W. Irwin",
       author_email = "irwin@beluga.phys.uvic.ca",
       url = "http://www.plplot.org",
       license = "LGPL",
       ext_modules = [module1,module2]
       )
