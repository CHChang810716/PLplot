# $Id$

# Load PLplot tcl extension

# This proc takes care of finding & loading the proper driver.

# The original version dealt with the possibility that either or both $dir and
# $file may contain spaces, or characters like []{}, but this hasn't been
# tested for this version.

proc load_pkg_Pltcl {dir} {
    global pllibrary tcl_platform auto_path
    #puts "loading Pltcl, dir: $dir"
    set pllibrary $dir

    if {$tcl_platform(platform) == "unix"} {
	set stem libplplottcltk
	set searchdirs ". ..";		# Need ".." for installed image
	set tags "d {}";		# prefer double precision version
	set ver @VERSION@
	set suf [info sharedlibextension].$ver

	set file ""
	foreach reldir $searchdirs {
	    foreach tag $tags {
		set driver [file join $dir $reldir $stem$tag$suf]
		#puts "looking for driver file: $driver"
		if [file exists $driver] {
		    set file $driver
		    break
		}
	    }
	    if { $file != "" } { break }
	}
	if { $file == "" } {
	    error "load_pkg_Pltcl: could not find loadable driver"
	}

    } else {
    # This is probably broken, someone should fix it.
	if {[info exists tcl_platform(debug)]} {
	    set file [file join $dir plplot510d[info sharedlibextension]]
	} else {
	    set file [file join $dir plplot510[info sharedlibextension]]
	}
    }

    load $file Pltcl
# put core tcl scripts in path
    lappend auto_path $dir/tcl
    rename load_pkg_Pltcl {}
}

package ifneeded Pltcl @PLPLOT_TCL_VERSION@ [list load_pkg_Pltcl $dir]

