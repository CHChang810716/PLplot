# -*-makefile-*----------------------------------------------------------------
# $Id$
#
# Maurice LeBrun
# IFS, University of Texas at Austin
# 14-Jul-1994
#
# Make assignments and targets for installation under Unix.
#
# It is recommended that you use a dedicated directory such as
# /usr/local/plplot (read the FAQ on this topic).  The install directory
# will be created if necessary, as will all required subdirectories.
#
# If support for <pkg> is not included, $(INSTALL_<PKG>) will be null.
#
# If a shared library was built, rebuild executables before installing.
# -----------------------------------------------------------------------------

# This target needed because of interdependency between libraries and 
# dynamic drivers.

install_lib_drivers: install_lib install_drivers

# TCL must appear before TK in this list because symlinks installed by
# TK are decided by the existence of the x??.tcl files installed by TCL.

install: install_lib_drivers \
	$(INSTALL_F77) \
	$(INSTALL_PYTHON) \
	$(INSTALL_JAVA) \
	$(INSTALL_TCL) \
	$(INSTALL_TK) \
	$(INSTALL_CXX) \
	$(INSTALL_OCTAVE) \
	install_demos \
	install_drivers \
	install_utils

install_demos:
	@-if test ! -d $(DEMOS_DIR); then mkdir -p $(DEMOS_DIR); fi; \
	  if test ! -d $(DEMOS_DIR)/c; then mkdir -p $(DEMOS_DIR)/c; fi; \
	  $(CP) Makedemo $(DEMOS_DIR)/Makefile; \
	  $(CP) ../test/test_*.sh plplot-test.sh $(DEMOS_DIR); \
	  chmod a+x $(DEMOS_DIR)/plplot-test.sh; \
	  $(LN) ../Makefile $(DEMOS_DIR)/c; \
	  cd $(top_srcdir)/examples/c; \
	  $(CP) *.c $(DEMOS_DIR)/c; \
	  $(CP) *.h $(INCLUDE_DIR)

install_plrender: install_lib_drivers
	@-if test $(SHARED) = 1; then \
	  $(LDC) $(LDC_FLAGS) plrender$O $(LIB_INSTALL) \
		-o plrender$E $(LDC_LIBS) $(INSTALL_RPATH); \
	  fi; \
	  strip plrender$E; \
	  $(CP) plrender$E $(BIN_DIR)

install_pltek: install_lib_drivers
	@-strip pltek$E; $(CP) pltek$E $(BIN_DIR)

install_plplot_config:
	 @$(CP) plplot-config $(BIN_DIR); \
	 chmod a+x $(BIN_DIR)/plplot-config

# Install the dynamically loadable drivers and the drivers database,
# if any.
# Also libplplot is linked against the symlinks below if the corresponding
# dynamic driver dll's exist (test -r for cross-platform compatibility).
# Note these symlinks override incorrect ones that may have been created with 
# the library installation via cp libplplot* etc from the plplot/tmp location.
install_drivers:
	@-if test -d drivers; then \
	      if test ! -d $(DATA_DIR)/../drivers; then mkdir -p $(DATA_DIR)/../drivers; fi; \
	      $(CP) drivers/* $(DATA_DIR)/../drivers; \
	      if test -r $(DATA_DIR)/../drivers/tkwin$(LIB_TAG)_drv.so; then \
	      	 $(LN) $(DATA_DIR)/../drivers/tkwin$(LIB_TAG)_drv.so \
	      	 $(LIB_DIR)/libplplot_tkwin_driver$(LIB_TAG).so ; \
	      fi ; \
	  fi

install_utils: install_plrender install_pltek install_plplot_config

