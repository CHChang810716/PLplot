#!/usr/bin/env python

from distutils.core import setup, Extension

# Unusual special plplot logic at start of setup.py to sort out different
# behaviour for tmp location (special *last* option of --flat) and install 
# location.
import sys
if sys.argv[-1] == "--flat":
    print "flat"
    del sys.argv[-1]
    import os
    include_directory = os.getcwd()
    library_directory = include_directory
else:
    include_directory = '@prefix@/@INCLUDE_DIR@/..'
    library_directory = '@prefix@/@LIB_DIR@'

extra_link_args = ['-Wl,-rpath', '-Wl,' + library_directory]
include_dirs = [include_directory]
# Only needed because arrayobject.h not necessarily in Numeric subdirectory 
# in python-1.5.  Once we drop support for python-1.5, then we can change 
# the plmodule.h include to standard Numeric/ form and drop this append 
# altogether.
include_dirs.append('@PYTHON_NUM_DIR@')

library_dirs = [library_directory]
libraries = ['plplotd']

# Done with --flat or not plplot logic to decide extra_link_args, include_dirs,
# library_dirs and libraries.  Now get on with usual setup.py stuff.

module1 = Extension( 'plmodule', 
		     extra_link_args = extra_link_args,
                     include_dirs = include_dirs,
		     library_dirs = library_dirs,
		     libraries = libraries,
		     sources = ['plmodule.c']
		     )

module2 = Extension( 'pyqt_plmodule', 
		     extra_link_args = extra_link_args,
                     include_dirs = include_dirs,
		     library_dirs = library_dirs,
		     libraries = libraries,
		     sources = ['pyqt_plmodule.c']
		     )

setup( name = "pl",
       version = "5.1",
       description = "PLplot Python extension module",
       author = "Alan W. Irwin",
       author_email = "irwin@beluga.phys.uvic.ca",
       url = "http://www.plplot.org",
       license = "LGPL",
       ext_modules = [module1,module2]
       )
