# File: Makefile.in
# Description: Makefile template for PLplot-DocBook project
# Author: Rafael Laboissière <rafael@icp.inpg.fr>
# Created on: Thu May 20 11:14:38 CEST 1999
# Last modified on: Mon Oct 30 11:55:29 CET 2000
# $Id$

stylesheet_html = plplotdoc-html.dsl
stylesheet_print = plplotdoc-print.dsl
html_destdir = ../html
sgml_sources = $(shell ls *.sgml *.ent)
perl_scripts = $(shell ls *.pl)
sources = $(sgml_sources) $(perl_scripts)
plplotdoc_html=plplotdoc-html
jade = @JADE@
jadetex = @JADETEX@
perl = @PERL@
sgml_catalogs=@SGML_CATALOGS@

base = plplotdoc
main_html = book1.html

all: html ps

inline.manifest: inline-greek.pl
	$(perl) inline-greek.pl

over-under.eps: over-under.tex
	$(perl) tex2eps.pl -s `cat over-under.tex` -x 1000 -o over-under.eps

over-under-big.eps: over-under.tex
	$(perl) tex2eps.pl -s `cat over-under.tex` -x 5000 \
          -o over-under-big.eps

over-under.jpeg: over-under-big.eps
	$(perl) eps2jpeg.pl -g 35% -i over-under-big.eps -o over-under.jpeg

html: html-stamp 
html-stamp: $(sgml_sources) $(stylesheet_html) inline-html.ent \
            over-under.jpeg inline.manifest
	ln -fs inline-html.ent inline.ent
	$(jade) $(sgml_catalogs) -d $(stylesheet_html) -t sgml $(base).sgml
	touch html-stamp

ps: ps-stamp
ps-stamp: $(base).tex over-under.eps
	$(jadetex) $(base).tex
	$(jadetex) $(base).tex
	dvips -f $(base) | gzip -c > $(base).ps.gz
	touch ps-stamp

$(base).tex: $(sgml_sources) $(stylesheet_print) inline-print.ent
	ln -fs inline-print.ent inline.ent
	$(jade) $(sgml_catalogs) -d $(stylesheet_print) -t tex $(base).sgml

version: 
	echo '0.0.1' > version


install: install-stamp
install-stamp: version html-stamp ps-stamp index.html
	mkdir -p $(html_destdir)
	rm -rf $(html_destdir)/*
	mkdir $(plplotdoc_html)-`cat version`
	cp `$(perl) included-html-files.pl < $(main_html)` $(main_html) \
	   index.html `cat inline.manifest` \
           over-under.jpeg $(plplotdoc_html)-`cat version` 
	cp $(plplotdoc_html)-`cat version`/* $(html_destdir)
	tar cfz $(plplotdoc_html)-`cat version`.tar.gz \
            $(plplotdoc_html)-`cat version`
	rm -rf $(plplotdoc_html)-`cat version`
	mkdir -p $(html_destdir)/$(srcdir)
	cp $(sources) Makefile $(stylesheet_html) $(stylesheet_print) \
          included-html-files.pl $(html_destdir)/$(srcdir)
	mv $(base).ps.gz $(plplotdoc_html)-`cat version`.tar.gz \
          $(html_destdir)
	ln -sf ./$(plplotdoc_html)-`cat version`.tar.gz \
               $(html_destdir)/$(plplotdoc_html).tar.gz
	touch install-stamp

clean:
	rm -f *.html $(base).{tex,dvi,aux,log,ps.gz} *-stamp version \
	      TMP* inline.ent *.eps *.jpeg inline.manifest \
	      conftest.* config.*
	rm -rf $(html_destdir)

.PHONY: all html ps install clean
